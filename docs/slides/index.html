<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>isd ‚Äì interactive systemd</title>
    <meta name="description" content="isd (interactive systemd) ‚Äì a better way to work with systemd units">
    <meta name="author" content="Kai Norman Clasen">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="preload" as="font" href="fonts.css" crossorigin="anonymous"> -->
    <link rel="stylesheet" href="fonts.css">
    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="asciinema-player.css">
    <link rel="stylesheet" href="dist/theme/night.css" id="theme">
    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="plugin/highlight/monokai.css">
  </head>
  <body>
    <div class="reveal">
      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">
        <section>
          <div class="vfill">
            <a href="https://kainctl.github.io/isd/">
              <img src="isd.png" alt="isd logo" style="max-height: 20vh; margin: 0 auto 0 auto; background: transparent;" class="demo-logo">
            </a>
            <h1>isd ‚Äì interactive systemd</h1>
            <p>
              <small>Created by
                <a href="https://kainctl.github.io/isd/">Kai Norman Clasen</a></small>
            </p>
          </div>
        </section>
        <section>
          <h2>A Bit About Me</h2>
          <ul class="vfill">
            <li>
              Hobby System Administrator since a few years
              <br>
              <small>(I use NixOS ‚ùÑÔ∏è btw.)</small>
            </li>
            <li class="fragment">
              Actively started working with
              <code>systemd</code>
              almost 2 years ago
            </li>
            <li class="fragment">
              Features of
              <code>systemd</code>
              ‚©µ ‚ô•Ô∏è
            </li>
            <li class="fragment">
              User experience of
              <code>systemd</code>
              ‚©µ üòê
            </li>
          </ul>
        </section>
        <section>
          <h2>Example</h2>
          <div class="vfill">
            <p>
              Assume we have written a
              <code>systemd</code>
              unit file called
              <code class="fname">awesome-hello-world.service</code>
            </p>
            <pre>
              <code data-trim data-noescape class="language-toml">
                [Unit]
                Description=Awesome Hello World Server
                After=network.target

                [Service]
                ExecStart=/opt/hello/awesome-hello-world.py
                DynamicUser=yes
                PrivateTmp=yes
                RestrictAddressFamilies=AF_UNIX AF_INET6
                SystemCallFilter=~@chown @clock @cpu-emulation @privileged

                [Install]
                WantedBy=multi-user.target
              </code>
            </pre>
          </div>
        </section>
        <section>
          <h2>My Old Workflow</h2>
        </section>
        <section>
          <div id="old_workflow.cast"></div>
        </section>
        <section>
          <h2><code>sysz</code></h2>
          <ul class="vfill">
            <li>
              a terminal UI (<em>TUI</em>) for
              <code>systemctl</code>
            </li>
            <li>
              is written as a shell script wrapping around
              <code>systemctl</code>
              utilizing  the
              <code>fzf</code>
              tool
            </li>
            <li>
              includes a
              <code>status</code>
              preview window and
              automatically prefixes
              <code>sudo</code>
              if necessary
            </li>
          </ul>
        </section>
        <section>
          <div id="sysz_workflow.cast"></div>
        </section>
        <section>
          <div class="vfill">
            <h2>Biggest Limitation of
              <code>sysz</code>:</h2>
            <p class="fname large fragment">Stateless</p>
          </div>
        </section>
        <section>
          <h2><code>sysz</code>
            code snippet</h2>
          <div class="vfill">
            <pre>
            <code data-trim data-noescape class="language-bash" data-line-numbers="1-30|4,6,14">
            _sysz_systemctl() {
              if [[ $EUID -ne 0 && $1 = --system ]]; then
                # only run sudo if we aren't root and it's a system unit
                _sysz_run sudo systemctl "$@"
              else
                _sysz_run systemctl "$@"
              fi
            }


            _sysz_journalctl() {
              if [[ $1 = --user ]]; then
                # use --user-unit flag if it's a user unit
                _sysz_run journalctl --user-unit="$2" "${@:3}"
            # [...]
          </code>
        </pre>
          </div>
        </section>
        <section>
          <h2>isd Workflow</h2>
        </section>
        <section>
          <div id="new_workflow.cast"></div>
        </section>
        <section>
          <div id="custom.cast"></div>
        </section>
        <section>
          <h2>CLI tools<br>
            + modern TUI frameworks
            <br>
            = üöÄüíòüöÄ</h2>
        </section>
        <section>
          <h2>Lessons Learned</h2>
        </section>
        <section>
          <h3>
            Insight 1: Take advantage of
            <em>upstream</em>
          </h3>
          <ul class="vfill">
            <li>
              CLI tools expose a cherry-picked API that upstream
              <em>recommends</em>
              and
              <em>tests</em>
              against.
            </li>
            <li>
              Wrapping around upstream CLI tools can be a great core to develop useful TUIs.
            </li>
            <li>
              Using a CLI avoids re-developing a lot of the functionality.
            </li>
          </ul>
        </section>
        <section>
          <h3>
            Insight 2: Limit the scope
          </h3>
          <ul class="vfill">
            <li>
              Use the
              <em>correct</em>
              tool for the job!
            </li>
            <li>
              Avoid recreating a worse version of a tool
              that you could use instead.
            </li>
          </ul>
        </section>
        <section>
          lnav example
        </section>
        <section>
          <h3>
            Insight 3: TUI users like customization options
          </h3>
          <ul class="vfill">
            <li>
              keybindings/shortcuts
            </li>
            <li>
              Pager example
            </li>
          </ul>
        </section>
        <section data-preload data-background-iframe="./customization.html" data-background-interactive>
          <div style="position: absolute; width: 45%; bottom: 10%; right: 0; box-shadow: 0 1px 4px rgba(0,0,0,0.5), 0 5px 25px rgba(0,0,0,0.2); background-color: rgba(0, 0, 0, 0.9); color: #fff; padding: 20px; font-size: 20px; text-align: left;">
            <p>... but nobody likes to read the documentation.</p>
          </div>
        </section>
        <section>
          <h3>
            Insight 4: LSPs are great for configuration files
          </h3>
        </section>
        <section>
          LSP asciicast
        </section>
      </div>
    </div>
    <script src="dist/reveal.js"></script>
    <script src="plugin/zoom/zoom.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/search/search.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script src="asciinema-player.min.js"></script>
    <!-- html += "<script>" -->
    <!-- html += "if (document.readyState === 'loading') {" -->
    <!-- html += "document.addEventListener('DOMContentLoaded', function() {" -->
    <!-- html += create_player_js -->
    <!-- html += "});" -->
    <!-- html += "} else {" -->
    <!-- html += create_player_js -->
    <!-- html += "}" -->
    <!-- html += "</script>" -->
    <script>
      <!-- *.cast -->
      document.querySelectorAll('[id$=".cast"]').forEach(el => {
        <!-- document.fonts.load("1em CascadiaCodeNF").then(() => { -->
          new AsciinemaPlayer.create(
            el.id,
            document.getElementById(el.id), {
              autoPlay: false,
              controls: true,
              loop: false,
              preload: true,
              speed: 0.75,
              pauseOnMarkers: true,
              <!-- fit: false, -->
              <!-- terminalFontSize: "20px", -->
            }
          );
        });
      <!-- }); -->
    </script>
    <script>
      // Also available as an ES module, see:
			// https://revealjs.com/initialization/
			Reveal.initialize({
				controls: true,
				progress: true,
				center: false,
				hash: true,
        display: 'flex',
        overview: false,
        // Optional function that blocks keyboard events when retuning false
        keyboardCondition: function(event) {
          // Don't let Reveal.js handle keyboard if target is inside asciinema player
          return !event.target.closest('.ap-wrapper');
        },

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealHighlight ]
			});
    </script>
  </body>
</html>